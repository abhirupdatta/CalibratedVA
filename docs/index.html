<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CalibratedVA • CalibratedVA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="CalibratedVA">
<meta property="og:description" content="Uses Gibbs sampling to estimate the true underlying distribution
    of cause of disease when you have access to a calibration set and an
    imperfect training set">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">CalibratedVA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/CalibratedVA.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jfiksel/CalibratedVA/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="calibratedva" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#calibratedva" class="anchor"></a>CalibratedVA</h1></div>
<!-- badges: start -->

<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Before installation of CalibratedVA, we recommend first installing the latest version of LaplacesDemon from <a href="https://github.com/">GitHub</a>:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="co"># install.packages("remotes")</span>
<span class="kw pkg">remotes</span><span class="kw ns">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"LaplacesDemonR/LaplacesDemon"</span>)</pre></div>
<p>You can then install the development version of CalibratedVA from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="co"># install.packages("remotes")</span>
<span class="kw pkg">remotes</span><span class="kw ns">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"jfiksel/CalibratedVA"</span>)</pre></div>
</div>
<div id="getting-started-with-calibratedva" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started-with-calibratedva" class="anchor"></a>Getting started with CalibratedVA</h2>
<div id="phmrc-data" class="section level3">
<h3 class="hasAnchor">
<a href="#phmrc-data" class="anchor"></a>PHMRC Data</h3>
<p>The Population Health Metrics Research Consortium (PHMRC) study contains gold-standard cause-of-death (GS-COD) data for children, neonates and adults in 4 countries, making it a perfect dataset to demonstrate the merits of <code>CalibratedVA</code>.</p>
<p>We have used the openVA package to obtain cause-of-death predictions for adult deaths from Tanzania. Both InSilicoVA and Tariff were trained using deaths from the other 3 countries. We obtained individual cause probability predictions from InSilicoVA and individual top cause-of-death predictions from Tariff. We will also read in the GS-COD for each death from Tanzania.</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">CalibratedVA</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"insilico_tanzania"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"tariff_tanzania"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"gs_cod_tanzania"</span>)</pre></div>
<p>There are 34 causes, which is too many causes for CalibratedVA to be useful. We will map these causes to broader causes, using the following cause map.</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"phmrc_adult_cause_map"</span>)</pre></div>
<p>To map the causes, we can provide either the probability matrix:</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="no">insilico_tanzania</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/map_causes.html">map_causes</a></span>(<span class="no">insilico_tanzania</span>, <span class="no">phmrc_adult_cause_map</span>)</pre></div>
<p>Or the character vector with the predicted cause or GS-COD for each individual</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="no">tariff_tanzania</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/map_causes.html">map_causes</a></span>(<span class="no">tariff_tanzania</span>$<span class="no">cause</span>, <span class="no">phmrc_adult_cause_map</span>)
<span class="no">gs_cod_tanzania</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/map_causes.html">map_causes</a></span>(<span class="no">gs_cod_tanzania</span>, <span class="no">phmrc_adult_cause_map</span>)</pre></div>
</div>
<div id="single-algorithm-predictions" class="section level3">
<h3 class="hasAnchor">
<a href="#single-algorithm-predictions" class="anchor"></a>Single algorithm predictions</h3>
<p>We will first run CalibratedVA using the Tariff predictions. To run CalibratedVA, we will first select a set of individuals to be in our “hospital” set–that is, individuals for whom we know their GS-COD. These individuals will be used for estimation of algorithm misclassification rates. We will simply use the first 200 individuals from the data. We will use the default settings for all hyperparameter values.</p>
<div class="sourceCode" id="cb7"><pre class="r"><span class="no">causes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">tariff_tanzania</span>)
<span class="no">tariff_calibratedva</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/calibratedva.html">calibratedva</a></span>(<span class="kw">va_unlabeled</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[-(<span class="fl">1</span>:<span class="fl">200</span>),],
                                    <span class="kw">va_labeled</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                    <span class="kw">gold_standard</span> <span class="kw">=</span> <span class="no">gs_cod_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                    <span class="kw">causes</span> <span class="kw">=</span> <span class="no">causes</span>,
                                    <span class="kw">nchains</span> <span class="kw">=</span> <span class="fl">3</span>,
                                    <span class="kw">ndraws</span> <span class="kw">=</span> <span class="fl">2000</span>,
                                    <span class="kw">burnin</span> <span class="kw">=</span> <span class="fl">1000</span>)</pre></div>
<p>We can use the <code>ggmcmc</code> package to obtain CSMF estimates for the individual causes, along with credible intervals.</p>
<div class="sourceCode" id="cb8"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggmcmc</span>)
<span class="no">P</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">Parameter</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"p["</span>, <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">causes</span>), <span class="st">"]"</span>),
  <span class="kw">Label</span><span class="kw">=</span><span class="no">causes</span>)
<span class="no">tariff_csmf_samples</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html">ggs</a></span>(<span class="no">tariff_calibratedva</span>$<span class="no">samples</span>, <span class="kw">par_labels</span><span class="kw">=</span><span class="no">P</span>, <span class="kw">family</span><span class="kw">=</span><span class="st">"p"</span>)
<span class="co">#&gt; Warning: `tbl_df()` is deprecated as of dplyr 1.0.0.</span>
<span class="co">#&gt; Please use `tibble::as_tibble()` instead.</span>
<span class="co">#&gt; This warning is displayed once every 8 hours.</span>
<span class="co">#&gt; Call `lifecycle::last_warnings()` to see where this warning was generated.</span>
<span class="co">### CSMF with credible intervals</span>
<span class="no">tariff_csmf</span> <span class="kw">&lt;-</span>
  <span class="no">tariff_csmf_samples</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">Parameter</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">csmf</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">value</span>),
            <span class="kw">ci_L</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">value</span>, <span class="fl">.025</span>),
            <span class="kw">ci_U</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">value</span>, <span class="fl">.975</span>))
<span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span>
<span class="no">tariff_csmf</span>
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   Parameter         csmf   ci_L  ci_U</span>
<span class="co">#&gt;   &lt;fct&gt;            &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 circulatory      0.122 0.0374 0.241</span>
<span class="co">#&gt; 2 external         0.137 0.0323 0.302</span>
<span class="co">#&gt; 3 infectious       0.301 0.0740 0.578</span>
<span class="co">#&gt; 4 maternal         0.187 0.0417 0.377</span>
<span class="co">#&gt; 5 non_communicable 0.253 0.0436 0.513</span></pre></div>
<p>We can also view the traceplot</p>
<div class="sourceCode" id="cb9"><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_traceplot.html">ggs_traceplot</a></span>(<span class="no">tariff_csmf_samples</span>)</pre></div>
<p><img src="reference/figures/README-tariff_csmf_traceplot-1.png" width="100%"></p>
<p>And a posterior density plot</p>
<div class="sourceCode" id="cb10"><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_density.html">ggs_density</a></span>(<span class="no">tariff_csmf_samples</span>)</pre></div>
<p><img src="reference/figures/README-tariff_csmf_density_plot-1.png" width="100%"></p>
</div>
<div id="using-predictions-from-multiple-algorithms-ensemble" class="section level3">
<h3 class="hasAnchor">
<a href="#using-predictions-from-multiple-algorithms-ensemble" class="anchor"></a>Using predictions from multiple algorithms (ensemble)</h3>
<p>We can use both the predictions from both InSilicoVA and Tariff to better estimate the CSMF using the ensemble approach. We simply need to format the predictions into a list of matrices</p>
<div class="sourceCode" id="cb11"><pre class="r"><span class="no">ensemble_unlabeled</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">tariff_tanzania</span>[-(<span class="fl">1</span>:<span class="fl">200</span>),], <span class="no">insilico_tanzania</span>[-(<span class="fl">1</span>:<span class="fl">200</span>),])
<span class="no">ensemble_labeled</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">tariff_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,], <span class="no">insilico_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,])</pre></div>
<div class="sourceCode" id="cb12"><pre class="r"><span class="no">ensemble_calibratedva</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/calibratedva.html">calibratedva</a></span>(<span class="kw">va_unlabeled</span> <span class="kw">=</span> <span class="no">ensemble_unlabeled</span>,
                                      <span class="kw">va_labeled</span> <span class="kw">=</span> <span class="no">ensemble_labeled</span>,
                                      <span class="kw">gold_standard</span> <span class="kw">=</span> <span class="no">gs_cod_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                      <span class="kw">causes</span> <span class="kw">=</span> <span class="no">causes</span>,
                                      <span class="kw">nchains</span> <span class="kw">=</span> <span class="fl">3</span>,
                                      <span class="kw">ndraws</span> <span class="kw">=</span> <span class="fl">2000</span>,
                                      <span class="kw">burnin</span> <span class="kw">=</span> <span class="fl">1000</span>)</pre></div>
<div class="sourceCode" id="cb13"><pre class="r"><span class="no">ensemble_csmf_samples</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html">ggs</a></span>(<span class="no">ensemble_calibratedva</span>$<span class="no">samples</span>, <span class="kw">par_labels</span><span class="kw">=</span><span class="no">P</span>, <span class="kw">family</span><span class="kw">=</span><span class="st">"p"</span>)
<span class="co">### CSMF with credible intervals</span>
<span class="no">ensemble_csmf</span> <span class="kw">&lt;-</span>
  <span class="no">ensemble_csmf_samples</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">Parameter</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">csmf</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">value</span>),
            <span class="kw">ci_L</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">value</span>, <span class="fl">.025</span>),
            <span class="kw">ci_U</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">value</span>, <span class="fl">.975</span>))
<span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span>
<span class="no">ensemble_csmf</span>
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   Parameter          csmf   ci_L  ci_U</span>
<span class="co">#&gt;   &lt;fct&gt;             &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 circulatory      0.0703 0.0153 0.137</span>
<span class="co">#&gt; 2 external         0.185  0.0863 0.286</span>
<span class="co">#&gt; 3 infectious       0.306  0.0992 0.552</span>
<span class="co">#&gt; 4 maternal         0.163  0.0473 0.308</span>
<span class="co">#&gt; 5 non_communicable 0.276  0.0896 0.489</span></pre></div>
<p>We can also view the traceplot</p>
<div class="sourceCode" id="cb14"><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_traceplot.html">ggs_traceplot</a></span>(<span class="no">ensemble_csmf_samples</span>)</pre></div>
<p><img src="reference/figures/README-ensemble_csmf_traceplot-1.png" width="100%"></p>
<p>And a posterior density plot</p>
<div class="sourceCode" id="cb15"><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_density.html">ggs_density</a></span>(<span class="no">ensemble_csmf_samples</span>)</pre></div>
<p><img src="reference/figures/README-ensemble_csmf_density_plot-1.png" width="100%"></p>
</div>
<div id="additional-features" class="section level3">
<h3 class="hasAnchor">
<a href="#additional-features" class="anchor"></a>Additional features</h3>
<p>Please view the <a href="https://jfiksel.github.io/CalibratedVA/articles/CalibratedVA.html">“Get Started”</a> tab to see additional features in CalibratedVA.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/jfiksel/CalibratedVA/">https://​github.com/​jfiksel/​CalibratedVA/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/jfiksel/CalibratedVA/issues">https://​github.com/​jfiksel/​CalibratedVA/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Jacob Fiksel <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-7067-1334" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Abhirup Datta <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.com/jfiksel/CalibratedVA"><img src="https://travis-ci.com/jfiksel/CalibratedVA.svg?branch=master" alt="Travis build status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Jacob Fiksel, Abhirup Datta.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
