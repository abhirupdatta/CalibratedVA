<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overview of CalibratedVA • CalibratedVA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Overview of CalibratedVA">
<meta property="og:description" content="CalibratedVA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CalibratedVA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/CalibratedVA.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jfiksel/CalibratedVA/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Overview of CalibratedVA</h1>
                        <h4 class="author">Jacob Fiksel</h4>
            
            <h4 class="date">2020-06-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jfiksel/CalibratedVA/blob/master/vignettes/CalibratedVA.Rmd"><code>vignettes/CalibratedVA.Rmd</code></a></small>
      <div class="hidden name"><code>CalibratedVA.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Many countries cannot conduct full autopsies for the majority of deaths due to either cultural or economic limitations <span class="citation">(AbouZahr et al. 2015; Allotey et al. 2015)</span>. Rather than perform an invasive autopsy, an alternative method to determine the cause (or “etiology”) of death (COD) is to conduct a <em>verbal autopsy</em> (VA), where relatives of the deceased individual are asked a set list of questions to obtain information about symptoms experienced by the deceased observed prior to death <span class="citation">(Soleman, Chandramohan, and Shibuya 2006)</span>. Medical experts can then use these VA responses to determine the COD for an individual.</p>
<p>If we are interested in obtaining causes of death for a large amount of individuals in a region or country, in order to determine optimal resource allocation, we need an efficient way to scale the process of determining the COD from VA data. Several algorithms have recently been proposed to automatically predict COD from VA records. These <em>computer coded</em> VA (CCVA) algorithms predict COD using the VA records as input. Examples include Tariff <span class="citation">(James, Flaxman, and Murray 2011; Serina et al. 2015)</span>, interVA <span class="citation">(Byass et al. 2012)</span>, and InsilicoVA <span class="citation">(McCormick et al. 2016)</span>. These algorithms all require some gold standard (GS) information – either a training dataset with both VA symptom data and a gold standard (GS) COD determined for each individual or some symptom-given-cause probability matrix.</p>
<p>If we are interested in obtaining national estimates of cause specific mortality fraction (CSMF), we cantrain one of the above CCVA algorithms with GS COD data from our country of interest, obtain individual predictions from CCVA data for the country of interest, and then aggregate the predictions to the CSMF level. However, there may be limited amounts of GS COD data for a new country. In addition, algorithms trained on GS COD from other countries may not be as accurate.</p>
<p>The CalibratedVA package is to be used for exactly the situation above– we take predictions from one or multiple algorithm(s) trained on a large non-local dataset, and use the local GS COD dataset to improve the CSMF estimates via local calibration.</p>
</div>
<div id="phmrc-data" class="section level2">
<h2 class="hasAnchor">
<a href="#phmrc-data" class="anchor"></a>PHMRC Data</h2>
<p>The Population Health Metrics Research Consortium (PHMRC) study contains GS COD data for children, neonates and adults in 4 countries, making it a perfect dataset to demonstrate the merits of <code>CalibratedVA</code>.</p>
<p>We have used the openVA package to obtain cause-of-death predictions for adult deaths from Tanzania. Both InSilicoVA and Tariff were trained using deaths from the other 3 countries. We obtained individual cause probability predictions from InSilicoVA and individual top cause-of-death predictions from Tariff. We will also read in the GS-COD for each death from Tanzania.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">CalibratedVA</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"insilico_tanzania"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"tariff_tanzania"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"gs_cod_tanzania"</span>)</pre></body></html></div>
<p>There are 34 causes, which is too many causes for CalibratedVA to be useful. We will map these causes to broader causes, using the following cause map.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"phmrc_adult_cause_map"</span>)</pre></body></html></div>
<p>To map the causes, we can provide either the probability matrix:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">insilico_tanzania</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/map_causes.html">map_causes</a></span>(<span class="no">insilico_tanzania</span>, <span class="no">phmrc_adult_cause_map</span>)</pre></body></html></div>
<p>Or the character vector with the predicted cause or GS-COD for each individual</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">tariff_tanzania</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/map_causes.html">map_causes</a></span>(<span class="no">tariff_tanzania</span>$<span class="no">cause</span>, <span class="no">phmrc_adult_cause_map</span>)
<span class="no">gs_cod_tanzania</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/map_causes.html">map_causes</a></span>(<span class="no">gs_cod_tanzania</span>, <span class="no">phmrc_adult_cause_map</span>)</pre></body></html></div>
</div>
<div id="calibratedva" class="section level2">
<h2 class="hasAnchor">
<a href="#calibratedva" class="anchor"></a>CalibratedVA</h2>
<div id="single-algorithm-predictions" class="section level3">
<h3 class="hasAnchor">
<a href="#single-algorithm-predictions" class="anchor"></a>Single algorithm predictions</h3>
<p>We will first run CalibratedVA using the Tariff predictions. To run CalibratedVA, we will first select a set of individuals to be in our “hospital” set–that is, individuals for whom we know their GS-COD. These individuals will be used for estimation of algorithm misclassification rates. We will simply use the first 200 individuals from the data. We will use the default settings for all hyperparameter values.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">causes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">tariff_tanzania</span>)
<span class="no">tariff_calibratedva</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/calibratedva.html">calibratedva</a></span>(<span class="kw">A_U</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[-(<span class="fl">1</span>:<span class="fl">200</span>),],
                                    <span class="kw">A_L</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                    <span class="kw">G_L</span> <span class="kw">=</span> <span class="no">gs_cod_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                    <span class="kw">causes</span> <span class="kw">=</span> <span class="no">causes</span>)</pre></body></html></div>
<p>We can use the <code>ggmcmc</code> package to obtain CSMF estimates for the individual causes, along with credible intervals.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggmcmc</span>)
<span class="no">P</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">Parameter</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"p["</span>, <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">causes</span>), <span class="st">"]"</span>),
  <span class="kw">Label</span><span class="kw">=</span><span class="no">causes</span>)
<span class="no">tariff_csmf_samples</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html">ggs</a></span>(<span class="no">tariff_calibratedva</span>$<span class="no">samples</span>, <span class="kw">par_labels</span><span class="kw">=</span><span class="no">P</span>, <span class="kw">family</span><span class="kw">=</span><span class="st">"p"</span>)
<span class="co">### CSMF with credible intervals</span>
<span class="no">tariff_csmf</span> <span class="kw">&lt;-</span>
  <span class="no">tariff_csmf_samples</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">Parameter</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">csmf</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">value</span>),
            <span class="kw">ci_L</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">value</span>, <span class="fl">.025</span>),
            <span class="kw">ci_U</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">value</span>, <span class="fl">.975</span>))
<span class="no">tariff_csmf</span>
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   Parameter         csmf   ci_L  ci_U</span>
<span class="co">#&gt;   &lt;fct&gt;            &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 circulatory      0.122 0.0374 0.241</span>
<span class="co">#&gt; 2 external         0.137 0.0323 0.302</span>
<span class="co">#&gt; 3 infectious       0.301 0.0740 0.578</span>
<span class="co">#&gt; 4 maternal         0.187 0.0417 0.377</span>
<span class="co">#&gt; 5 non_communicable 0.253 0.0436 0.513</span></pre></body></html></div>
<p>We can also view the traceplot</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_traceplot.html">ggs_traceplot</a></span>(<span class="no">tariff_csmf_samples</span>)</pre></body></html></div>
<p><img src="CalibratedVA_files/figure-html/tariff_csmf_traceplot-1.png" width="768"></p>
<p>And a posterior density plot</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_density.html">ggs_density</a></span>(<span class="no">tariff_csmf_samples</span>)</pre></body></html></div>
<p><img src="CalibratedVA_files/figure-html/tariff_csmf_density_plot-1.png" width="768"></p>
</div>
<div id="using-predictions-from-multiple-algorithms-ensemble" class="section level3">
<h3 class="hasAnchor">
<a href="#using-predictions-from-multiple-algorithms-ensemble" class="anchor"></a>Using predictions from multiple algorithms (ensemble)</h3>
<p>We can use both the predictions from both InSilicoVA and Tariff to better estimate the CSMF using the ensemble approach. We simply need to format the predictions into a list of matrices</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">ensemble_unlabeled</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">tariff_tanzania</span>[-(<span class="fl">1</span>:<span class="fl">200</span>),], <span class="no">insilico_tanzania</span>[-(<span class="fl">1</span>:<span class="fl">200</span>),])
<span class="no">ensemble_labeled</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">tariff_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,], <span class="no">insilico_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,])</pre></body></html></div>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">ensemble_calibratedva</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/calibratedva.html">calibratedva</a></span>(<span class="kw">A_U</span> <span class="kw">=</span> <span class="no">ensemble_unlabeled</span>,
                                      <span class="kw">A_L</span> <span class="kw">=</span> <span class="no">ensemble_labeled</span>,
                                      <span class="kw">G_L</span> <span class="kw">=</span> <span class="no">gs_cod_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                      <span class="kw">causes</span> <span class="kw">=</span> <span class="no">causes</span>)</pre></body></html></div>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">ensemble_csmf_samples</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html">ggs</a></span>(<span class="no">ensemble_calibratedva</span>$<span class="no">samples</span>, <span class="kw">par_labels</span><span class="kw">=</span><span class="no">P</span>, <span class="kw">family</span><span class="kw">=</span><span class="st">"p"</span>)
<span class="co">### CSMF with credible intervals</span>
<span class="no">ensemble_csmf</span> <span class="kw">&lt;-</span>
  <span class="no">ensemble_csmf_samples</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">Parameter</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">csmf</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">value</span>),
            <span class="kw">ci_L</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">value</span>, <span class="fl">.025</span>),
            <span class="kw">ci_U</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">value</span>, <span class="fl">.975</span>))
<span class="no">ensemble_csmf</span>
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   Parameter          csmf   ci_L  ci_U</span>
<span class="co">#&gt;   &lt;fct&gt;             &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 circulatory      0.0689 0.0167 0.134</span>
<span class="co">#&gt; 2 external         0.168  0.0631 0.288</span>
<span class="co">#&gt; 3 infectious       0.271  0.0450 0.493</span>
<span class="co">#&gt; 4 maternal         0.172  0.0446 0.309</span>
<span class="co">#&gt; 5 non_communicable 0.320  0.119  0.524</span></pre></body></html></div>
<p>We can also view the traceplot</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_traceplot.html">ggs_traceplot</a></span>(<span class="no">ensemble_csmf_samples</span>)</pre></body></html></div>
<p><img src="CalibratedVA_files/figure-html/ensemble_csmf_traceplot-1.png" width="768"></p>
<p>And a posterior density plot</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_density.html">ggs_density</a></span>(<span class="no">ensemble_csmf_samples</span>)</pre></body></html></div>
<p><img src="CalibratedVA_files/figure-html/ensemble_csmf_density_plot-1.png" width="768"></p>
</div>
</div>
<div id="more-details-on-shrinkage" class="section level2">
<h2 class="hasAnchor">
<a href="#more-details-on-shrinkage" class="anchor"></a>More details on shrinkage</h2>
<div id="increasing-levels-of-shrinkage" class="section level3">
<h3 class="hasAnchor">
<a href="#increasing-levels-of-shrinkage" class="anchor"></a>Increasing levels of shrinkage</h3>
<p>We can increase the alpha parameter to increase the amount of shrinkage. As an extreme example, we will set alpha = 500, and show that the estimated CSMF is very similar to the predicted CSMF</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">tariff_highshrinkage</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/calibratedva.html">calibratedva</a></span>(<span class="kw">A_U</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[-(<span class="fl">1</span>:<span class="fl">200</span>),],
                                    <span class="kw">A_L</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                    <span class="kw">G_L</span> <span class="kw">=</span> <span class="no">gs_cod_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                    <span class="kw">causes</span> <span class="kw">=</span> <span class="no">causes</span>,
                                    <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">500</span>)</pre></body></html></div>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co">### CSMF with credible intervals</span>
<span class="no">tariff_highshrinkage_csmf</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html">ggs</a></span>(<span class="no">tariff_highshrinkage</span>$<span class="no">samples</span>, <span class="kw">par_labels</span><span class="kw">=</span><span class="no">P</span>, <span class="kw">family</span><span class="kw">=</span><span class="st">"p"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">Parameter</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">csmf</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">value</span>))
<span class="no">tariff_highshrinkage_csmf</span>
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;   Parameter         csmf</span>
<span class="co">#&gt;   &lt;fct&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt; 1 circulatory      0.105</span>
<span class="co">#&gt; 2 external         0.167</span>
<span class="co">#&gt; 3 infectious       0.300</span>
<span class="co">#&gt; 4 maternal         0.146</span>
<span class="co">#&gt; 5 non_communicable 0.282</span>
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(<span class="no">tariff_tanzania</span>[-(<span class="fl">1</span>:<span class="fl">200</span>),])
<span class="co">#&gt;      circulatory         external       infectious         maternal </span>
<span class="co">#&gt;        0.1080636        0.1716950        0.2934723        0.1508502 </span>
<span class="co">#&gt; non_communicable </span>
<span class="co">#&gt;        0.2759188</span></pre></body></html></div>
</div>
<div id="bayesian-approach-using-csmf-shrinkage" class="section level3">
<h3 class="hasAnchor">
<a href="#bayesian-approach-using-csmf-shrinkage" class="anchor"></a>Bayesian approach using CSMF shrinkage</h3>
<p>Rather than shrinking the misclassification matrix (“M”) to the identity matrix, we can directly shrink the CSMF (“p”) to the predicted CSMF on the unlabeled data. This is simply done using <code>method = "pshrink"</code>. When using this method, the level of shrinkage is controlled by <code>lambda</code>, where higher values lead to more shrinkage. Setting <code>lambda = 1</code> (the default) will lead to little shrinkage.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">tariff_pshrink</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/calibratedva.html">calibratedva</a></span>(<span class="kw">A_U</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[-(<span class="fl">1</span>:<span class="fl">200</span>),],
                               <span class="kw">A_L</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                               <span class="kw">G_L</span> <span class="kw">=</span> <span class="no">gs_cod_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                               <span class="kw">causes</span> <span class="kw">=</span> <span class="no">causes</span>,
                               <span class="kw">method</span> <span class="kw">=</span> <span class="st">"pshrink"</span>,
                               <span class="kw">lambda</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_density.html">ggs_density</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html">ggs</a></span>(<span class="no">tariff_pshrink</span>$<span class="no">samples</span>, <span class="kw">par_labels</span><span class="kw">=</span><span class="no">P</span>, <span class="kw">family</span><span class="kw">=</span><span class="st">"p"</span>))</pre></body></html></div>
<p><img src="CalibratedVA_files/figure-html/tariff_pshrink-1.png" width="768"></p>
<p>We can see that the above approach leads to multimodality. We can use the <code>tune_calibratedva</code> function to choose a value of <code>lambda</code> which has the best WAIC, and for which the posterior will be unimodal and will have a low Rhat. The below example only uses 5 values of lambda for the gridsearch, but we recommend searching over a larger number of values. We will also reduce the number of draws from 10,000 (default) to 5,000. This is not necessarily recommended, but will reduce the run-time for this example.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">tariff_pshrink_tuned</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tune_calibratedva.html">tune_calibratedva</a></span>(<span class="kw">A_U</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[-(<span class="fl">1</span>:<span class="fl">200</span>),],
                                          <span class="kw">A_L</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                          <span class="kw">G_L</span> <span class="kw">=</span> <span class="no">gs_cod_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                          <span class="kw">causes</span> <span class="kw">=</span> <span class="no">causes</span>,
                                          <span class="kw">method</span> <span class="kw">=</span> <span class="st">"pshrink"</span>,
                                          <span class="kw">lambda_vec</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.1</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span>),
                                          <span class="kw">ndraws</span> <span class="kw">=</span> <span class="fl">5000</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_density.html">ggs_density</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html">ggs</a></span>(<span class="no">tariff_pshrink_tuned</span>$<span class="no">final_model</span>$<span class="no">samples</span>, <span class="kw">par_labels</span><span class="kw">=</span><span class="no">P</span>, <span class="kw">family</span><span class="kw">=</span><span class="st">"p"</span>))</pre></body></html></div>
<p><img src="CalibratedVA_files/figure-html/tariff_tune-1.png" width="768"></p>
<p>We can also compare the WAIC of the chosen model to the WAIC of the uncalibrated model, as well as to the WAIC values for all values of the parameter we performed the grid search over:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">tariff_pshrink_tuned</span>$<span class="no">waic_final</span>
<span class="co">#&gt; [1] 6256.641</span>
<span class="no">tariff_pshrink_tuned</span>$<span class="no">waic_uncalib</span>
<span class="co">#&gt; [1] 8224.48</span>
<span class="no">tariff_pshrink_tuned</span>$<span class="no">waic_df</span>
<span class="co">#&gt;   param waic_calib multimodal rhat_max</span>
<span class="co">#&gt; 1   0.1   6269.791       TRUE 1.908583</span>
<span class="co">#&gt; 2   1.0   6263.065       TRUE 1.939429</span>
<span class="co">#&gt; 3  10.0   6257.456      FALSE 1.171580</span>
<span class="co">#&gt; 4  50.0   6256.721      FALSE 1.045764</span>
<span class="co">#&gt; 5 100.0   6256.641      FALSE 1.026168</span></pre></body></html></div>
<p>We can also tune the models by collecting a list of models for different values of lambda (or alpha for M-shrinkage), and supplying this list to <code>tune_calibratedva</code>. This is especially useful if we want to use parallelization to run the Gibbs sampling for the grid search, and then obtain the best model.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">lambda_vec</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.1</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span>)
<span class="no">tariff_samples_list</span> <span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">lambda_vec</span>, <span class="kw">function</span>(<span class="no">lambda</span>) {
  <span class="no">calibrateva_out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/calibratedva.html">calibratedva</a></span>(<span class="kw">A_U</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[-(<span class="fl">1</span>:<span class="fl">200</span>),],
                                  <span class="kw">A_L</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                  <span class="kw">G_L</span> <span class="kw">=</span> <span class="no">gs_cod_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                  <span class="kw">causes</span> <span class="kw">=</span> <span class="no">causes</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"pshrink"</span>,
                                  <span class="kw">lambda</span> <span class="kw">=</span> <span class="no">lambda</span>, <span class="kw">ndraws</span> <span class="kw">=</span> <span class="fl">5000</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">calibrateva_out</span>)
})
<span class="no">tariff_pshrink_tuned2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tune_calibratedva.html">tune_calibratedva</a></span>(<span class="kw">A_U</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[-(<span class="fl">1</span>:<span class="fl">200</span>),],
                                           <span class="kw">A_L</span> <span class="kw">=</span> <span class="no">tariff_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                           <span class="kw">G_L</span> <span class="kw">=</span> <span class="no">gs_cod_tanzania</span>[<span class="fl">1</span>:<span class="fl">200</span>,],
                                           <span class="kw">causes</span> <span class="kw">=</span> <span class="no">causes</span>,
                                           <span class="kw">method</span> <span class="kw">=</span> <span class="st">"pshrink"</span>,
                                           <span class="kw">samples_list</span> <span class="kw">=</span> <span class="no">tariff_samples_list</span>,
                                           <span class="kw">lambda_vec</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.1</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span>))
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">tariff_pshrink_tuned</span>$<span class="no">waic_df</span>, <span class="no">tariff_pshrink_tuned2</span>$<span class="no">waic_df</span>)
<span class="co">#&gt; [1] TRUE</span></pre></body></html></div>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-abouzahr2015civil">
<p>AbouZahr, Carla, Don De Savigny, Lene Mikkelsen, Philip W Setel, Rafael Lozano, Erin Nichols, Francis Notzon, and Alan D Lopez. 2015. “Civil Registration and Vital Statistics: Progress in the Data Revolution for Counting and Accountability.” <em>The Lancet</em> 386 (10001). Elsevier: 1373–85.</p>
</div>
<div id="ref-allotey2015let">
<p>Allotey, Pascale A, Daniel D Reidpath, Natalie C Evans, Nirmala Devarajan, Kanason Rajagobal, Ruhaida Bachok, Kridaraan Komahan, and SEACO Team. 2015. “Let’s Talk About Death: Data Collection for Verbal Autopsies in a Demographic and Health Surveillance Site in Malaysia.” <em>Global Health Action</em> 8 (1). Taylor &amp; Francis: 28219.</p>
</div>
<div id="ref-interva">
<p>Byass, Peter, Daniel Chandramohan, Samuel J Clark, Lucia D’ambruoso, Edward Fottrell, Wendy J Graham, Abraham J Herbst, et al. 2012. “Strengthening Standardised Interpretation of Verbal Autopsy Data: The New Interva-4 Tool.” <em>Global Health Action</em> 5 (1). Taylor &amp; Francis: 19281.</p>
</div>
<div id="ref-tariff">
<p>James, Spencer L, Abraham D Flaxman, and Christopher JL Murray. 2011. “Performance of the Tariff Method: Validation of a Simple Additive Algorithm for Analysis of Verbal Autopsies.” <em>Population Health Metrics</em> 9 (1). BioMed Central: 31.</p>
</div>
<div id="ref-insilico">
<p>McCormick, Tyler H, Zehang Richard Li, Clara Calvert, Amelia C Crampin, Kathleen Kahn, and Samuel J Clark. 2016. “Probabilistic Cause-of-Death Assignment Using Verbal Autopsies.” <em>Journal of the American Statistical Association</em> 111 (515). Taylor &amp; Francis: 1036–49.</p>
</div>
<div id="ref-tariff2">
<p>Serina, Peter, Ian Riley, Andrea Stewart, Spencer L James, Abraham D Flaxman, Rafael Lozano, Bernardo Hernandez, et al. 2015. “Improving Performance of the Tariff Method for Assigning Causes of Death to Verbal Autopsies.” <em>BMC Medicine</em> 13 (1). BioMed Central: 291.</p>
</div>
<div id="ref-soleman2006verbal">
<p>Soleman, Nadia, Daniel Chandramohan, and Kenji Shibuya. 2006. “Verbal Autopsy: Current Practices and Challenges.” <em>Bulletin of the World Health Organization</em> 84. SciELO Public Health: 239–45.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jacob Fiksel, Abhirup Datta.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
